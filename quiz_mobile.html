<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>DrillSet Web</title>
<style>
:root{--bg:#f8f9fa;--card:#ffffff;--text:#202124;--sub:#5f6368;--primary:#4285f4;--success:#34a853;--error:#ea4335;--border:#e0e0e0;--hover:#f1f3f4;--deep:#2b579a}
body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Microsoft YaHei UI",Roboto,Helvetica,Arial,sans-serif}
.app{max-width:900px;margin:0 auto;padding:12px}
.header{display:flex;align-items:center;justify-content:space-between;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px}
.title{font-size:20px;color:var(--primary);font-weight:700}
.actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
.btn{appearance:none;border:1px solid var(--border);background:#fff;color:var(--text);padding:10px 14px;border-radius:10px;font-size:16px;white-space:nowrap;line-height:1;flex:0 0 auto}
.btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
.btn.warn{background:#fbbc05;color:#fff;border-color:#fbbc05}
.select{border:1px solid var(--border);border-radius:10px;padding:8px 10px;background:#fff;font-size:14px;white-space:nowrap}
.file{position:relative;overflow:hidden}
.file input{position:absolute;inset:0;opacity:0}
.content{margin-top:12px;background:var(--card);border:1px solid var(--border);border-radius:12px}
.card{padding:12px}
.type{font-size:14px;color:var(--primary);font-weight:700;margin-bottom:8px}
.question{text-align:justify;font-size:16px;line-height:1.6;border:1px solid var(--border);border-radius:10px;padding:10px;background:#fff;word-break:break-word}
.options{margin-top:10px;display:flex;flex-direction:column;gap:8px}
.option{display:flex;align-items:flex-start;gap:10px;background:#fff;border:1px solid var(--border);border-radius:10px;padding:12px}
.option.selected{background:var(--deep);color:#fff;border-color:var(--deep)}
.result{margin-top:14px}
.result .line{height:1px;background:var(--border);margin:10px 0}
.result .title{font-size:16px;font-weight:700}
.answer{white-space:pre-wrap;border:1px solid var(--border);border-radius:10px;padding:10px;background:#fff}
.footer{position:sticky;bottom:0;background:var(--bg);padding:12px}
.bar{display:flex;gap:8px;overflow-x:auto;-webkit-overflow-scrolling:touch;justify-content:center}
.list-panel{position:fixed;inset:auto 0 0 0;max-height:60%;background:var(--card);border-top:1px solid var(--border);border-radius:12px 12px 0 0;transform:translateY(100%);transition:.2s;box-shadow:0 -10px 20px rgba(0,0,0,.06)}
.list-panel.show{transform:translateY(0)}
.list-head{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--border)}
.list{overflow:auto;max-height:45vh}
.list-item{padding:12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between}
.stat{font-size:13px;color:var(--sub)}
@media(min-width:768px){.list-panel{left:auto;right:12px;bottom:12px;width:320px;max-height:70vh;border-radius:12px;transform:translateY(10px);opacity:0}.list-panel.show{transform:translateY(0);opacity:1}}
@media(max-width:420px){.btn{font-size:13px;padding:7px 10px}.select{font-size:13px;padding:7px 10px}.title{font-size:18px}}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div>
      <div class="title">üìö Âà∑È¢òÁ≥ªÁªü</div>
      <div class="stat" id="stat">È¢òÁõÆ: 0/0</div>
    </div>
    <div class="actions">
      <label class="btn file">üìÅ Âä†ËΩΩ<input id="file" type="file" accept=".txt"></label>
      <select id="filter" class="select">
        <option>ÂÖ®ÈÉ®</option>
        <option>ÂçïÈÄâÈ¢ò</option>
        <option>Â§öÈÄâÈ¢ò</option>
        <option>Âà§Êñ≠È¢ò</option>
      </select>
      <button class="btn" id="toggleList">ÂàóË°®</button>
    </div>
  </div>
  <div class="content">
    <div class="card">
      <div class="type" id="type"></div>
      <div class="question" id="question"></div>
      <div class="options" id="options"></div>
      <div class="result" id="result" style="display:none">
        <div class="line"></div>
        <div class="title" id="resultTitle"></div>
        <div class="answer" id="answer"></div>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="bar">
      <button class="btn" id="prev" title="‰∏ä‰∏ÄÈ¢ò">< ‰∏ä‰∏ÄÈ¢ò</button>
      <button class="btn primary" id="submit" title="Êèê‰∫§Á≠îÊ°à">‚úì Êèê‰∫§</button>
      <button class="btn" id="next" title="‰∏ã‰∏ÄÈ¢ò">‰∏ã‰∏ÄÈ¢ò ></button>
    </div>
    <div class="bar" style="margin-top:8px">
      <button class="btn" id="random">üé≤ ÈöèÊú∫</button>
      <button class="btn warn" id="reset">‚ü≤ ÈáçÁΩÆ</button>
    </div>
  </div>
  <div class="list-panel" id="panel">
    <div class="list-head">
      <div>È¢òÁõÆÂàóË°®</div>
      <button class="btn" id="closePanel">ÂÖ≥Èó≠</button>
    </div>
    <div class="list" id="list"></div>
  </div>
</div>
<script>
const state={questions:[],filtered:[],index:0,selected:new Set(),answered:false,correct:0,total:0}
const els={file:document.getElementById('file'),filter:document.getElementById('filter'),toggleList:document.getElementById('toggleList'),panel:document.getElementById('panel'),closePanel:document.getElementById('closePanel'),list:document.getElementById('list'),stat:document.getElementById('stat'),type:document.getElementById('type'),question:document.getElementById('question'),options:document.getElementById('options'),result:document.getElementById('result'),resultTitle:document.getElementById('resultTitle'),answer:document.getElementById('answer'),prev:document.getElementById('prev'),next:document.getElementById('next'),submit:document.getElementById('submit'),random:document.getElementById('random'),reset:document.getElementById('reset')}
function parse(lines){const qs=[];let cur=null;for(let i=0;i<lines.length;i++){const line=lines[i];const qm=/^([0-9]+)\.\s*(.*)/.exec(line);if(qm){if(cur){qs.push(cur)}cur={originalNumber:parseInt(qm[1]),question:qm[2],options:[],answer:"",analysis:"",type:"Êú™Áü•"};continue}
if(/^[A-D]\.\s*/.test(line)){if(cur){const parts=line.split('.',2);if(parts.length===2){cur.options.push({letter:parts[0],text:parts[1].trim()})}}continue}
if(line.startsWith('Á≠îÊ°àÔºö')){if(cur){const ans=line.replace('Á≠îÊ°àÔºö','').trim();let analysis='';if(i+1<lines.length && lines[i+1].startsWith('Ëß£ÊûêÔºö')){i++;analysis=lines[i].replace('Ëß£ÊûêÔºö','').trim();while(i+1<lines.length && !/^([0-9]+)\./.test(lines[i+1]) && !/^[A-D]\.\s*/.test(lines[i+1]) && !lines[i+1].startsWith('Á≠îÊ°àÔºö')){i++;analysis+="\n"+lines[i].trim()}}cur.answer=ans;cur.answerAnalysis=analysis?ans+"\n\nËß£ÊûêÔºö"+analysis:ans}continue}
if(line.startsWith('Ëß£ÊûêÔºö')){if(cur){let analysis=line.replace('Ëß£ÊûêÔºö','').trim();while(i+1<lines.length && !/^([0-9]+)\./.test(lines[i+1]) && !/^[A-D]\.\s*/.test(lines[i+1]) && !lines[i+1].startsWith('Á≠îÊ°àÔºö')){i++;analysis+="\n"+lines[i].trim()}if(cur.answerAnalysis){cur.answerAnalysis+="\n\n"+analysis}else{cur.answerAnalysis=analysis}}continue}
if(cur){cur.question+=(cur.question?"\n":"")+line}}
if(cur){qs.push(cur)}qs.forEach(q=>{q.type=detectType(q)});return qs}
function getAnswerLetters(ans){if(!ans)return[];const m=ans.toUpperCase().match(/[A-F]/g);return m?m:[]}
function detectType(q){const count=q.options.length;if(count===2){return 'Âà§Êñ≠È¢ò'}const letters=getAnswerLetters(q.answer||'');if(letters.length>1){return 'Â§öÈÄâÈ¢ò'}return 'ÂçïÈÄâÈ¢ò'}
function setFilter(type){if(type==='ÂÖ®ÈÉ®'){state.filtered=[...state.questions]}else{state.filtered=state.questions.filter(q=>q.type===type)}state.index=0;renderList();if(state.filtered.length){show(0)}else{els.type.textContent='';els.question.textContent='Ê≤°ÊúâÁ¨¶ÂêàÊù°‰ª∂ÁöÑÈ¢òÁõÆ';els.options.innerHTML='';els.result.style.display='none'} }
function renderList(){els.list.innerHTML='';state.filtered.forEach((q,i)=>{const status=q.answered? (q.answeredCorrect?'‚úì':'‚úó'):'‚óã';const div=document.createElement('div');div.className='list-item';const left=document.createElement('div');left.textContent=`${status} Á¨¨${i+1}È¢ò ${q.type}`;const right=document.createElement('button');right.className='btn';right.textContent='ÊâìÂºÄ';right.onclick=()=>{show(i);togglePanel(false)};div.appendChild(left);div.appendChild(right);els.list.appendChild(div)});els.stat.textContent=`È¢òÁõÆ: ${state.index+1}/${state.filtered.length}`}
function show(idx){if(!state.filtered.length||idx<0||idx>=state.filtered.length)return;state.index=idx;state.answered=false;state.selected.clear();els.result.style.display='none';const q=state.filtered[idx];els.stat.textContent=`È¢òÁõÆ: ${idx+1}/${state.filtered.length}`;els.type.textContent=`${q.type} - Á¨¨${idx+1}È¢ò${q.originalNumber?` (Âéü${q.originalNumber})`:''}`;els.question.textContent=q.question;els.options.innerHTML='';if(q.type==='Âà§Êñ≠È¢ò'){if(q.options.length===2){q.options.forEach((o,i)=>createOption(o.text,i,o.letter))}else{createOption('Ê≠£Á°Æ',0,'A');createOption('ÈîôËØØ',1,'B')}}else{q.options.forEach((o,i)=>createOption(o.text,i,o.letter))}els.prev.disabled=idx===0;els.next.disabled=idx>=state.filtered.length-1;els.submit.disabled=false}
function createOption(text,index,letter){const div=document.createElement('div');div.className='option';const label=document.createElement('div');label.textContent=`${letter?letter+'. ':''}${text}`;div.appendChild(label);div.onclick=()=>clickOption(index);els.options.appendChild(div)}
function isSelected(index){const q=state.filtered[state.index];if(q.type==='Â§öÈÄâÈ¢ò'){return state.selected.has(index)}return state.selected.has(index)}
function clickOption(index){if(state.answered)return;const q=state.filtered[state.index];if(q.type==='Â§öÈÄâÈ¢ò'){if(state.selected.has(index)){state.selected.delete(index)}else{state.selected.add(index)}updateOptionStyles()}else{state.selected.clear();state.selected.add(index);updateOptionStyles()}}
function updateOptionStyles(){[...els.options.children].forEach((el,i)=>{const selected=isSelected(i);el.classList.toggle('selected',selected)})}
function submit(){if(state.answered)return;if(!state.selected.size){alert('ËØ∑ÈÄâÊã©Á≠îÊ°àÂêéÂÜçÊèê‰∫§');return}state.answered=true;state.total+=1;const q=state.filtered[state.index];const ok=check(q);if(ok){state.correct+=1;q.answeredCorrect=true}q.answered=true;showResult(q,ok);renderList();els.submit.disabled=true}
function check(q){const ans=(q.answer||'').trim();const ansLetters=getAnswerLetters(ans);if(q.type==='Âà§Êñ≠È¢ò'){if(state.selected.size!==1)return false;const idx=[...state.selected][0];const sel=String.fromCharCode(65+idx);if(ansLetters.length===1){return sel===ansLetters[0]}const truthy=['Ê≠£Á°Æ','ÂØπ','True'];const falsy=['ÈîôËØØ','Èîô','False'];if(truthy.includes(ans))return sel==='A';if(falsy.includes(ans))return sel==='B';return sel===ans}
if(q.type==='Â§öÈÄâÈ¢ò'){const sel=[...state.selected].map(i=>String.fromCharCode(65+i)).sort();const cor=ansLetters.sort();return JSON.stringify(sel)===JSON.stringify(cor)}
if(q.type==='ÂçïÈÄâÈ¢ò'){if(state.selected.size!==1)return false;const idx=[...state.selected][0];const sel=String.fromCharCode(65+idx);if(ansLetters.length===1){return sel===ansLetters[0]}return sel===ans}
return false}
function showResult(q,ok){els.result.style.display='block';els.resultTitle.textContent=ok?'‚úì ÂõûÁ≠îÊ≠£Á°ÆÔºÅ':'‚úó ÂõûÁ≠îÈîôËØØ';els.resultTitle.style.color=ok? 'var(--success)':'var(--error)';if(q.answerAnalysis){els.answer.textContent=q.answerAnalysis}else{els.answer.textContent=`Ê≠£Á°ÆÁ≠îÊ°àÔºö${q.answer||''}`}}
function prev(){if(state.index>0)show(state.index-1)}
function next(){if(state.index<state.filtered.length-1)show(state.index+1)}
function random(){if(state.filtered.length){const i=Math.floor(Math.random()*state.filtered.length);show(i)}}
function reset(){if(confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÁ≠îÈ¢òËÆ∞ÂΩïÂêóÔºü')){state.questions.forEach(q=>{q.answered=false;q.answeredCorrect=false});state.correct=0;state.total=0;show(state.index);renderList()}}
function togglePanel(show){els.panel.classList.toggle('show',show)}
els.toggleList.onclick=()=>togglePanel(true)
els.closePanel.onclick=()=>togglePanel(false)
els.prev.onclick=prev
els.next.onclick=next
els.random.onclick=random
els.reset.onclick=reset
els.submit.onclick=submit
els.filter.onchange=e=>setFilter(e.target.value)
els.file.onchange=e=>{const f=e.target.files[0];if(!f){return}if(!f.name.toLowerCase().endsWith('.txt')){alert('ËØ∑Âä†ËΩΩ .txt È¢òÂ∫ìÊñá‰ª∂');return}const reader=new FileReader();reader.onload=ev=>{const content=ev.target.result;const lines=content.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);state.questions=parse(lines);state.filtered=[...state.questions];state.index=0;renderList();if(state.filtered.length)show(0)};reader.readAsText(f,'utf-8')}
async function tryLoadDefault(){try{const res=await fetch('sets/È¢òÂ∫ì1.txt');if(!res.ok)throw new Error('not found');const content=await res.text();const lines=content.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);state.questions=parse(lines);state.filtered=[...state.questions];state.index=0;renderList();if(state.filtered.length)show(0)}catch(err){}}
document.addEventListener('DOMContentLoaded',()=>{tryLoadDefault()})
</script>
</body>
</html>
